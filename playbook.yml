---
- import_playbook: monitoring.yml

- hosts: all
  become: yes
  vars_files:
    - group_vars/database/postgres.yml
  tasks:
    - name: install pip
      become: yes
      apt:
        name: python3-pip
        state: present
        update_cache: yes

    - name: install docker-dependency
      pip:
        name: docker

    - name: start container
      community.docker.docker_container:
        name: redmine-example-app
        image: redmine
        ports:
          - "8080:3000"
        env:
          REDMINE_DB_POSTGRES: "{{ postgres_host }}"
          REDMINE_DB_PORT: "{{ postgres_port }}"
          REDMINE_DB_USERNAME: "{{ postgres_user }}"
          REDMINE_DB_PASSWORD: "{{ postgres_pass }}"
          REDMINE_DB_DATABASE: "{{ postgres_db }}"